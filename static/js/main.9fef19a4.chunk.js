(this["webpackJsonpimage-editor"]=this["webpackJsonpimage-editor"]||[]).push([[0],{133:function(e,t){},134:function(e,t){},135:function(e,t){},138:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(65),o=n.n(r),c=n(31),l=n(2),s=n(22),u=(n(49),n(8)),m=n(11),h=n(21),d=n(20),p=n(43),v=n.n(p),f=n(7),g=n(151),b=!1;try{var y={get passive(){return b=!0}};window.addEventListener("test",y,y),window.removeEventListener("test",y,y)}catch(R){b=!1}var E=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).rootDiv=void 0,a.onKeyUp=void 0,a.onKeyDown=void 0,a.onUnmount=void 0,a.rootDiv=i.a.createRef(),a.onKeyDown=e.onDown,a.onKeyUp=e.onUp,a.onUnmount=e.onUnmount,a}return Object(m.a)(n,[{key:"addEventListener",value:function(e,t){null!==this.rootDiv.current&&this.rootDiv.current.addEventListener(e,t,!!b&&{passive:!1})}},{key:"removeEventListener",value:function(e,t){null!==this.rootDiv.current&&this.rootDiv.current.removeEventListener(e,t)}},{key:"componentDidMount",value:function(){var e=this;document.onkeydown=function(t){return w(t,e.onKeyDown)},document.onkeyup=function(t){return w(t,e.onKeyUp)},this.addEventListener("touchstart",this.onKeyDown),this.addEventListener("touchend",this.onKeyUp),this.addEventListener("mousedown",this.onKeyDown),this.addEventListener("mouseup",this.onKeyUp)}},{key:"componentWillUnmount",value:function(){document.onkeydown=null,document.onkeyup=null,this.removeEventListener("touchstart",this.onKeyDown),this.removeEventListener("touchend",this.onKeyUp),this.removeEventListener("mousedown",this.onKeyDown),this.removeEventListener("mouseup",this.onKeyUp),this.onUnmount()}},{key:"render",value:function(){var e=this.props.clientState===f.ClientState.Connecting,t=this.props.clientState>=f.ClientState.Connected,n="Microphone ".concat(this.props.classNames),a=v()("Microphone__button",{hidden:!t,Microphone__button__active:this.props.clientState===f.ClientState.Recording,Microphone__button__inactive:this.props.clientState===f.ClientState.Stopping}),r=v()("Microphone__help","HelpText",{hidden:!t});return console.log("Client state: "+Object(f.stateToString)(this.props.clientState)),console.log(a),i.a.createElement("div",{className:n,ref:this.rootDiv},i.a.createElement("div",{style:{height:"50px"}}),e&&i.a.createElement(g.a,{size:"3vh",className:"Microphone__loading"}),i.a.createElement("div",{className:a},i.a.createElement("object",null,i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",tabIndex:0,viewBox:"-2 -2 24 24"},i.a.createElement("circle",{stroke:"#d8dfe6",strokeWidth:"0.5",cx:"10",cy:"10",r:"15",fill:"#ffffff"}),i.a.createElement("path",{d:"M10 10"}),i.a.createElement("path",{transform:"translate(2,2) scale(0.8)",x:"10",y:"10",d:"M9 18v-1.06A8 8 0 0 1 2 9h2a6 6 0 1 0 12 0h2a8 8 0 0 1-7 7.94V18h3v2H6v-2h3zM6 4a4 4 0 1 1 8 0v5a4 4 0 1 1-8 0V4z"})))),i.a.createElement("div",{className:r},"Press and hold space bar to talk"))}}]),n}(i.a.Component);function w(e,t){32===e.keyCode&&(e.preventDefault(),t(e))}var C=n(32),S={sepia:"sepia",vintage:"vintage",classic:"vintage",faded:"sepia",grayscale:"grayscale","black and white":"grayscale",kodachrome:"kodachrome",technicolor:"technicolor",polaroid:"polaroid",luminosity:"brightness",brightness:"brightness",light:"brightness",contrast:"contrast",saturation:"saturation",color:"saturation"},k=function(e,t){var n=e.filter((function(e){return e.type===t}));return n.length>0?n[0].value.toLowerCase():""},j=function(e,t){if(e.isFinal&&e.intent.intent.length>0){var n=e.intent;if("undo"===n.intent)t.undo();else if("add_filter"===n.intent){var a=k(e.entities,"filter");a in S&&t.enableFilter(S[a])}else if("remove_filter"===n.intent){var i=k(e.entities,"filter");i in S&&t.disableFilter(S[i])}else if("increase"===n.intent){var r=k(e.entities,"property");r in S&&t.incrementProperty(S[r])}else if("decrease"===n.intent){var o=k(e.entities,"property");o in S&&t.decrementProperty(S[o])}}},O={stopContext:function(e){},startContext:function(e){},clientState:f.ClientState.Disconnected,words:{},contextId:""},x=i.a.createContext(O),I=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(u.a)(this,n),(a=t.call(this,e)).browserClientStateChanged=function(e){a.setState(Object(C.a)({},a.state,{clientState:e}))},a.updateStateBySegmentChange=function(e){a.updateWords(e.words,e.contextId,e.id),j(e,a.props.imageEditor)},a.updateWords=function(e,t,n){var i={};a.state.contextId===t&&(i=a.state.words);for(var r=0;r<e.length;r++)e[r]&&"index"in e[r]&&(i[parseInt(e[r].index)]=e[r]);a.setState(Object(C.a)({},a.state,{words:i,contextId:t}));var o=a.props.transcriptDiv;if(i){var c=Object.keys(i).map((function(e){return parseInt(e)})).sort().map((function(e){return i[e].isFinal?"<b>".concat(i[e].value,"</b>"):i[e].value})).join(" ");o.innerHTML=c}},a.startContext=function(e){a.state.clientState!==f.ClientState.Disconnected?a.state.clientState===f.ClientState.Connected&&a.client.startContext((function(e){e&&console.error("Could not start recording",e)})):a.client.initialize((function(e){e&&console.error("Error initializing Speechly client:",e)}))},a.stopContext=function(e){a.state.clientState===f.ClientState.Recording&&a.client.stopContext((function(e){e&&console.error("Could not stop recording",e)}))},a.closeClient=function(){if(!(a.state.clientState<f.ClientState.Connected))try{a.client.close((function(e){void 0!==e&&console.error("Could not close client",e)}))}catch(R){console.error("Could not close client",R)}};var i={appId:a.props.appId,language:a.props.language};return console.log("Initializing client",i),a.client=new f.Client(i),a.client.onSegmentChange(a.updateStateBySegmentChange),a.client.onStateChange(a.browserClientStateChanged),a.state=O,a}return Object(m.a)(n,[{key:"render",value:function(){return i.a.createElement(x.Provider,{value:Object(C.a)({},this.state,{startContext:this.startContext,stopContext:this.stopContext,closeClient:this.closeClient})},this.props.children)}}]),n}(a.Component),D=x,P=n(69),U=n(5),F=function e(t,n){var a=this;Object(u.a)(this,e),this.editorHTMLDiv=void 0,this.imageUrl=void 0,this.canvas=void 0,this.htmlCanvas=void 0,this.operatorStack=void 0,this.imageObject=void 0,this.stepSize=new Map,this.incrementProperty=function(e){console.log("incrementProperty "+e);var t=a.stepSize.get(e);a.operatorStack.push({type:"property",name:e,value:t||0}),a.updateImage()},this.decrementProperty=function(e){console.log("decrementProperty "+e);var t=a.stepSize.get(e);a.operatorStack.push({type:"property",name:e,value:t?-1*t:0}),a.updateImage()},this.enableFilter=function(e){console.log("enableFilter "+e),a.operatorStack.push({type:"filter",name:e,value:1}),a.updateImage()},this.disableFilter=function(e){console.log("disableFilter "+e),a.operatorStack.push({type:"filter",name:e,value:0}),a.updateImage()},this.undo=function(){console.log("at undo"),a.operatorStack.pop(),a.updateImage()},this.updateImage=function(){console.log(a.operatorStack);var e=a.buildEditorState();if(console.log(e),a.imageObject.filters=[],0!==e.brightness){var t=new U.fabric.Image.filters.Brightness({brightness:e.brightness});a.imageObject.filters.push(t)}if(0!==e.contrast){var n=new U.fabric.Image.filters.Contrast({contrast:e.contrast});a.imageObject.filters.push(n)}if(0!==e.saturation){var i=new U.fabric.Image.filters.Saturation({saturation:e.saturation});a.imageObject.filters.push(i)}if(e.kodachrome>0){var r=a.makeKodachromeFilter();a.imageObject.filters.push(r)}if(e.vintage>0){var o=a.makeVintageFilter();a.imageObject.filters.push(o)}if(e.technicolor>0){var c=a.makeTechnicolorFilter();a.imageObject.filters.push(c)}if(e.polaroid>0){var l=a.makePolaroidFilter();a.imageObject.filters.push(l)}if(e.sepia>0){var s=new U.fabric.Image.filters.Sepia;a.imageObject.filters.push(s)}if(e.grayscale>0){var u=new U.fabric.Image.filters.Grayscale;a.imageObject.filters.push(u)}a.imageObject.applyFilters(),a.canvas.renderAll()},this.buildEditorState=function(){var e,t=a.cleanEditorState(),n=Object(P.a)(a.operatorStack);try{for(n.s();!(e=n.n()).done;){var i=e.value;"property"===i.type?t[i.name]+=i.value:"filter"===i.type&&(t[i.name]=i.value)}}catch(R){n.e(R)}finally{n.f()}return t},this.cleanEditorState=function(){return{brightness:0,contrast:0,saturation:0,grayscale:0,kodachrome:0,vintage:0,sepia:0,technicolor:0,polaroid:0}},this.resize=function(){var e=window.innerWidth,t=window.innerHeight;a.htmlCanvas.width=e,a.htmlCanvas.height=t,a.htmlCanvas.style.width="".concat(e,"px"),a.htmlCanvas.style.height="".concat(t,"px - 60px")},this.makeKodachromeFilter=function(){return console.log("at makeKodachromeFilter"),new U.fabric.Image.filters.ColorMatrix({matrix:[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0]})},this.makeVintageFilter=function(){return console.log("at makeVintageFilter"),new U.fabric.Image.filters.ColorMatrix({matrix:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]})},this.makeTechnicolorFilter=function(){return console.log("at makeTechnicolorFilter"),new U.fabric.Image.filters.ColorMatrix({matrix:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]})},this.makePolaroidFilter=function(){return console.log("at makePolaroidFilter"),new U.fabric.Image.filters.ColorMatrix({matrix:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]})},this.editorHTMLDiv=t,this.imageUrl=n,this.htmlCanvas=document.createElement("canvas"),this.htmlCanvas.id="canvas",this.resize(),this.editorHTMLDiv.appendChild(this.htmlCanvas),U.fabric.Object.prototype.transparentCorners=!1;var i=new U.fabric.Canvas(this.htmlCanvas);this.canvas=i,this.imageObject=new U.fabric.Image;var r=this;U.fabric.Image.fromURL(n,(function(e){if(e){r.imageObject=e;var t=L(e,i);r.canvas.add(t)}})),this.stepSize.set("brightness",.1),this.stepSize.set("contrast",.1),this.stepSize.set("saturation",.2),this.operatorStack=[]},L=function(e,t){var n,a=e.height||1e3,i=e.width||1e3,r=a/i,o=window.innerHeight/window.innerWidth,c=document.getElementsByClassName("canvas-container")[0];if(r<o){var l=.7*window.innerWidth,s=l*r*.7,u=l/i,m=s/a;n=e.set({left:0,top:(window.innerHeight-s)/10,scaleX:u,scaleY:m}),c.style.height="".concat(s,"px")}else{var h=window.innerWidth*o/r*.7,d=.7*window.innerHeight,p=h/i,v=d/a;n=e.set({left:(window.innerWidth-h)/2,top:0,scaleX:p,scaleY:v}),c.style.height="".concat(d,"px")}return n},N=function(e){var t=Object(a.useRef)(null),n=Object(a.useRef)(null),r=Object(a.useState)(),o=Object(s.a)(r,2),c=o[0],l=o[1],u=Object(a.useState)(),m=Object(s.a)(u,2),h=m[0],d=m[1],p="3e3cbd21-ca45-4eed-9747-e5522a056cd2";return Object(a.useEffect)((function(){if(e.location){var t=e.location.imgPath;if(t){var n={imgPath:t};localStorage.setItem("Speechly-image-editor-imagePath",JSON.stringify(n))}else{var a=localStorage.getItem("Speechly-image-editor-imagePath");t=JSON.parse(a).imgPath}d(t)}}),[e.location]),Object(a.useEffect)((function(){if(!c&&h){var e=new F(t.current,h);l(e)}}),[t,h,c]),i.a.createElement("div",null,i.a.createElement("section",{className:"photo"},i.a.createElement("div",{ref:t})),i.a.createElement("section",{className:"app"},i.a.createElement("div",{ref:n})),i.a.createElement("section",{className:"controls"},i.a.createElement(I,{appId:p,language:"en-US",imageEditor:c,transcriptDiv:n.current},i.a.createElement(D.Consumer,null,(function(e){var t=e.stopContext,n=e.startContext,a=e.closeClient,r=e.clientState;return i.a.createElement("div",null,i.a.createElement(E,{onUp:t,onDown:n,onUnmount:a,clientState:r,classNames:"Playground__mic"}),i.a.createElement("section",{className:"app"},i.a.createElement("i",null,i.a.createElement("b",null,"Try out these:")),i.a.createElement("ul",null,i.a.createElement("li",null,"make it black and white"),i.a.createElement("li",null,"add technicolor"),i.a.createElement("li",null,"deactivate black and white"),i.a.createElement("li",null,"add more light"),i.a.createElement("li",null,"less light"),i.a.createElement("li",null,"make it polaroid and reduce contrast"),i.a.createElement("li",null,"increase saturation and make it classic"))))})))))},M=n(71),_=n(70),K=n.n(_),z=function(){var e=Object(a.useState)(!1),t=Object(s.a)(e,2),n=t[0],r=t[1],o=Object(a.useState)({imgPath:["/photo-editor-demo/images/microphone_smaller.jpg"]}),l=Object(s.a)(o,2),u=l[0],m=l[1],h=Object(a.useRef)(null),d=n?"btn":"btn btn-disabled",p={pathname:"/edit/",imgPath:u.imgPath.slice(-1)[0]};return i.a.createElement("div",null,i.a.createElement("section",{className:"app intro"},i.a.createElement("img",{className:"logo",src:K.a,alt:""}),i.a.createElement("section",{className:"onboarding"},i.a.createElement("h1",null,"Use speech to edit and apply filters for your  photos and images"),i.a.createElement("section",{className:"gallery"},u.imgPath.map((function(e,t){return i.a.createElement("section",{className:"thumbnail",key:t},i.a.createElement("img",{src:e,alt:""}))})),i.a.createElement("section",{className:"upload upload-btn-wrapper"},i.a.createElement("button",{className:"upload-btn"},"Upload"),i.a.createElement("input",{type:"file",name:"myfile",ref:h,onChange:function(){var e;if(null===(e=h.current)||void 0===e?void 0:e.files){var t=h.current.files[0];m({imgPath:[].concat(Object(M.a)(u.imgPath),[URL.createObjectURL(t)])})}}}))),i.a.createElement("section",{className:"formRow"},i.a.createElement("input",{type:"checkbox",name:"micro",id:"micro",value:"",checked:n,onChange:function(e){return r(e.target.checked)}}),i.a.createElement("label",{htmlFor:"micro"},"Allow Audio to control over voice")),i.a.createElement(c.b,{to:p,className:d},"Start editing"))))},H=function(){return i.a.createElement("div",null,i.a.createElement(c.a,null,i.a.createElement(l.c,null,i.a.createElement(l.a,{exact:!0,path:"/",component:z}),i.a.createElement(l.a,{exact:!0,path:"/edit",component:N}))))};o.a.render(i.a.createElement(H,null),document.getElementById("root"))},49:function(e,t,n){},70:function(e,t,n){e.exports=n.p+"static/media/logo.4ecbb0d2.png"},73:function(e,t,n){e.exports=n(138)}},[[73,1,2]]]);
//# sourceMappingURL=main.9fef19a4.chunk.js.map